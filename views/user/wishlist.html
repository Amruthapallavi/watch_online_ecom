<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wish List</title>
    <link rel="stylesheet" href="/public/css/wishlist.css">
</head>
<body>
    <header>
        <div class="header-content">
            <h1 class="logo">Tick-Tock</h1>
            <div class="search-bar">
                <input type="text" placeholder="Search">
                <button>Go</button>
            </div>
            <nav>
                <ul>
                    <li><a href="#">Home</a></li>
                    <li><a href="#">Shop</a></li>
                    <li><a href="#">Account</a></li>
                    <li><a href="#"><i class="fa fa-heart"></i></a></li>
                    <li><a href="#"><i class="fa fa-shopping-cart"></i></a></li>
                    <li><a href="#">Logout</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main>
        <section class="wishlist">
            <h2>Wish List</h2>
            <div class="product-list">
                <h3>Products</h3>
                <div class="product-item">
                    <img src="https://example.com/omega-speedmaster.png" alt="Omega Speedmaster">
                    <div class="product-details">
                        <h4>Omega Speedmaster</h4>
                        <p>Availability: <span class="in-stock">In stock</span></p>
                        <p>Color: Black</p>
                        <p>MRP: 5679/-</p>
                        <div class="quantity-controls">
                            <button>-</button>
                            <input type="number" value="1" min="1">
                            <button>+</button>
                        </div>
                    </div>
                    <div class="product-actions">
                        <button class="remove">Remove</button>
                        <button class="add-to-cart">Add to Cart</button>
                    </div>
                </div>

                <!-- Repeat similar blocks for other products -->
            </div>
        </section>
    </main>

    <footer>
        <div class="footer-content">
            <div class="footer-column">
                <h3>Tick-Tock</h3>
                <p>Follow us on social media</p>
                <div class="social-icons">
                    <a href="#"><i class="fa fa-facebook"></i></a>
                    <a href="#"><i class="fa fa-twitter"></i></a>
                    <a href="#"><i class="fa fa-instagram"></i></a>
                    <a href="#"><i class="fa fa-youtube"></i></a>
                </div>
            </div>
            <div class="footer-column">
                <h3>About</h3>
                <ul>
                    <li><a href="#">About Us</a></li>
                    <li><a href="#">Category</a></li>
                    <li><a href="#">Blog</a></li>
                </ul>
            </div>
            <div class="footer-column">
                <h3>Information</h3>
                <ul>
                    <li><a href="#">Help Center</a></li>
                    <li><a href="#">Contact Us</a></li>
                </ul>
            </div>
            <div class="footer-column">
                <h3>Users</h3>
                <ul>
                    <li><a href="#">Login</a></li>
                    <li><a href="#">Register</a></li>
                    <li><a href="#">My Orders</a></li>
                </ul>
            </div>
        </div>
    </footer>

    <script src="/js/main.js"></script>
    <script>
        document.querySelectorAll('.quantity-controls button').forEach(button => {
    button.addEventListener('click', function () {
        const input = this.parentNode.querySelector('input');
        let value = parseInt(input.value);
        if (this.textContent === '-') {
            value = value > 1 ? value - 1 : 1;
        } else {
            value += 1;
        }
        input.value = value;
    });
});

document.querySelectorAll('.remove').forEach(button => {
    button.addEventListener('click', function () {
        this.closest('.product-item').remove();
    });
});

    </script>
</body>
</html>
















<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Details</title>
    <link rel="stylesheet" href="/css/order-details.css"> <!-- Link to CSS file -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script> <!-- SweetAlert CDN -->
</head>
<body>
    <div class="container">
        <div class="order-details">
            <h2>Order Details</h2>

            <!-- Order Information -->
            <div class="order-info">
                <p>Order ID: <%= order.paymentDetails.orderId %></p>
                <p>Date: <%= new Date(order.placedAt).toLocaleString('en-IN', { 
                    day: 'numeric', 
                    month: 'long', 
                    year: 'numeric', 
                    hour: '2-digit', 
                    minute: '2-digit' 
                }) %></p>
                
                <p>Status: 
                    <span class="order-status" style="color: 
                        <% if (order.orderStatus === 'confirmed') { %> green 
                        <% } else if (order.orderStatus === 'pending') { %> orange 
                        <% } else if (order.orderStatus === 'cancelled') { %> red 
                        <% } else if (order.orderStatus === 'delivered') { %> blue 
                        <% } %>;">
                        <%= order.orderStatus %>
                    </span>
                </p>
            </div>

            <!-- Product Details -->
            <div class="product-details">
                <h3>Product Details</h3>
                <% order.products.forEach(product => { %>
                    <div class="product-item">
                        <p><strong><%= product.pname %></strong></p>
                        <p>Qty: <%= product.quantity %></p>
                        <p>Price: ₹<%= product.price %></p> <!-- Displaying product price -->
                    </div>
                <% }) %>
            </div>

            <!-- Customer Information -->
            <div class="customer-info">
                <h3>Customer Information</h3>
                <p>Name: <%= user.name %></p>
                <p>Email: <%= user.email %></p>
                <p>Phone: <%= user.phone %></p>
            </div>

            <!-- Payment Details -->
            <div class="payment-info">
                <h3>Payment Information</h3>
                <p>Payment Method: <%= order.paymentDetails.method %></p>
                <p>Payment ID: <%= order.paymentDetails.paymentId %></p>
                <p>Total: ₹<%= order.grandTotal %></p>
            </div>
            <div class="order-actions">
                <% if (order.orderStatus === 'Delivered') { %>
                    <button id="returnOrderBtn">Return Order</button>

                <% } else if (order.orderStatus !== 'cancelled') { %>
                    <button id="cancelOrderBtn">Cancel Order</button>
                <% } else { %>
                    <button id="viewMyOrdersBtn" onclick="window.location.href='/my-orders'">View My Orders</button>
                <% } %>
            </div>
            
          
            <div id="cancelReasonForm" style="display: none;">
                <h3>Select a Reason for Cancellation</h3>
                <form id="reasonSelection">
                    <label>
                        <input type="radio" name="reason" value="Changed my mind" required> Changed my mind
                    </label>
                    <label>
                        <input type="radio" name="reason" value="Found a better price"> Found a better price
                    </label>
                    <label>
                        <input type="radio" name="reason" value="Product not needed"> Product not needed
                    </label>
                    <label>
                        <input type="radio" name="reason" value="Other"> Other
                        <input type="text" name="otherReason" placeholder="Specify if other">
                    </label>
                    <input type="hidden" name="orderId" id="orderId" value="<%= order._id %>">

                    <button type="submit">Continue</button>
                </form>
            </div>
            <!-- Add this div below the Return Order button -->
            <div id="returnReasonForm" style="display: none;">
                <h3>Select a Reason for Return</h3>
                <form id="returnReasonSelection">
                    <label>
                        <input type="radio" name="reason" value="Damaged product" required> Damaged product
                    </label>
                    <label>
                        <input type="radio" name="reason" value="Defective" required> Defective
                    </label>
                    <label>
                        <input type="radio" name="reason" value="Wrong item sent" required> Wrong item sent
                    </label>
                    <label>
                        <input type="radio" name="reason" value="Changed my mind" required> Changed my mind
                    </label>
                    <input type="hidden" name="orderId" id="returnOrderId" value="<%= order._id %>"> <!-- Hidden input for orderId -->
                    <button type="submit">Submit Return Request</button>
                </form>
            </div>
            

<script>
    document.getElementById('returnOrderBtn').addEventListener('click', function() {
        document.getElementById('returnReasonForm').style.display = 'block'; // Show the reason form
    });

    document.getElementById('returnReasonSelection').addEventListener('submit', function(e) {
        e.preventDefault(); // Prevent form submission

        const selectedReason = this.reason.value; // Get selected reason
        const orderId = document.getElementById('returnOrderId').value; // Get the order ID

        // Show confirmation popup
        Swal.fire({
            title: 'Are you sure you want to return this order?',
            text: "Reason: " + selectedReason,
            icon: 'warning',
            showCancelButton: true,
            confirmButtonText: 'Yes, return it!',
            cancelButtonText: 'No, keep it'
        }).then((result) => {
            if (result.isConfirmed) {
                // Proceed with the return process
                fetch('/return-order', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ orderId, reason: selectedReason }) // Send orderId and reason
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        Swal.fire('Done!', 'Your return request has been sent.', 'success')
                            .then(() => {
                                location.reload(); // Reload the page to reflect the changes
                            });
                    } else {
                        Swal.fire('Error!', 'There was an error processing your return.', 'error');
                    }
                });
            }
        });
    });
</script>

        </div>
    </div>

    <script>
        document.getElementById('cancelOrderBtn').addEventListener('click', function() {
            document.getElementById('cancelReasonForm').style.display = 'block'; // Show the reason form
        });

        document.getElementById('reasonSelection').addEventListener('submit', function(e) {
            e.preventDefault(); // Prevent form submission

            const selectedReason = this.reason.value; // Get selected reason
            const orderId = '<%= order._id %>'; // Get the order ID

            // Show confirmation popup
            Swal.fire({
                title: 'Are you sure you want to cancel this order?',
                text: "Reason: " + selectedReason,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'Yes, cancel it!',
                cancelButtonText: 'No, keep it'
            }).then((result) => {
                if (result.isConfirmed) {
                    // Proceed with the cancellation
                    fetch('/cancel-order', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ orderId, reason: selectedReason }) // Send orderId and reason
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            Swal.fire('Done!', 'Your order cancellation request has been sent.', 'success')
                                .then(() => {
                                    location.reload(); // Reload the page to reflect the changes
                                });
                        } else {
                            Swal.fire('Error!', 'There was an error cancelling your order.', 'error');
                        }
                    });
                }
            });
        });

        
    </script>
</body>
</html>




dashbard before changing black and white

<%- include('../include/adminHeader.ejs') %>

<link rel="stylesheet" href="/css/adminDashboard.css">
<title>Admin Dashboard</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background-color: #f4f4f4;
        margin: 0;
        padding: 0;
    }

    main {
        padding: 20px;
        max-width: 1200px;
        margin: auto;
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    h1 {
        text-align: center;
        color: #333;
    }

    h2 {
        color: #444;
        margin-bottom: 15px;
    }

    .summary {
        display: flex;
        justify-content: space-between;
        margin-bottom: 20px;
        flex-wrap: wrap; /* Allow wrapping on smaller screens */
    }

    .card {
        background: #f9f9f9;
        padding: 20px;
        border-radius: 8px;
        flex: 1 1 20%; /* Adjusted for better responsiveness */
        margin: 10px;
        text-align: center;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .sales-chart {
        margin-bottom: 20px;
    }

    .top-products {
        background: #f9f9f9;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
    }

    footer {
        text-align: center;
        padding: 10px 0;
        background: #f9f9f9;
        margin-top: 20px;
    }

    select, button {
        padding: 10px;
        margin: 10px 0;
        border-radius: 4px;
        border: 1px solid #ccc;
        transition: border-color 0.3s;
    }

    select:focus, button:focus {
        border-color: #007BFF; /* Change border color on focus */
        outline: none; /* Remove default outline */
    }

    .report-controls {
        display: flex;
        flex-direction: column; /* Stack controls vertically */
        align-items: flex-start;
        margin-bottom: 20px;
    }

    .generate-report-button, .download-button {
        margin-left: 10px;
    }

    .download-options {
        display: flex;
        justify-content: center; /* Center the download buttons */
        flex-direction: column; /* Stack buttons vertically */
        margin-top: 20px;
    }

    .download-button {
        background-color: #007BFF; /* Button color */
        color: white;
        border: none;
        cursor: pointer;
    }

    .download-button:hover {
        background-color: #0056b3; /* Darker on hover */
    }

    .download-button:active {
        background-color: #004494; /* Even darker when clicked */
    }

</style>
</head>
<body>

<main style="color: black;">
    <h1>Dashboard</h1>
    <div class="summary">
        <div class="card visits">
            <h2>Total Sales</h2>
            <p id="overallSales" style="color: black;"><%=data.totalGrandTotal%></p>
            <!-- <p>+20% month over month</p> -->
        </div>
        <div class="card revenue">
            <h2>Orders</h2>
            <p id="overallOrders"><%=data.totalOrders%></p>
            <!-- <p>+33% last month</p> -->
        </div>
        <div class="card sales">
            <h2>Discount</h2>
            <p id="overallDiscount"><%=data.totalAppliedOffers%></p>
            <!-- <p>-8% month over month</p> -->
        </div>
        <div class="card visits">
            <h2>Coupon Discount</h2>
            <p id="overallCoupon"><%=data.totalOfferDiscount%></p>
       </div>
        <div class="card products">
            <h2>Active Users</h2>
            <p id="allUser"><%=activeUsers%></p>
            <!-- <p>-8% month over month</p> -->
        </div>
    </div>
    <div>
        <h2>Sales Report</h2>
        <div class="report-controls">
            <label for="reportType">Report Type:</label>
            <select id="reportType">
                <option value="daily">Daily</option>
                <option value="weekly">Weekly</option>
                <option value="monthly">Monthly</option>
                <option value="yearly">Yearly</option>
                <option value="custom">Custom Range</option>
            </select>

            <div id="customRange" style="display: none;">
                <label for="startDate">Start Date:</label>
                <input type="date" id="startDate">
                <label for="endDate">End Date:</label>
                <input type="date" id="endDate">
            </div>

            <button class="generate-report-button" onclick="generateReport()">Generate Report</button>
        </div>
    </div>
    
    <div class="summary">
        <div class="card visits">
            <h2>Total Sales</h2>
            <p id="totalSales">₹0</p>
            <!-- <p>+20% month over month</p> -->
        </div>
        <div class="card revenue">
            <h2>Orders</h2>
            <p id="totalOrders">0</p>
            <!-- <p>+33% last month</p> -->
        </div>
        <div class="card sales">
            <h2>Discount</h2>
            <p id="totalDiscount">₹0</p>
            <!-- <p>-8% month over month</p> -->
        </div>
        <div class="card products">
            <h2>Active Users</h2>
            <p id="newUsers">0</p>
            <!-- <p>-8% month over month</p> -->
        </div>
    </div>
   
    <div class="summary">
        <!-- Profit Circle -->
        <div class="percentage-card">
            <h2>Profit</h2>
            <div class="percentage-circle profit" data-percentage="0"></div>
        </div>
    
        <!-- No. of Visits Circle -->
        <div class="percentage-card">
            <h2>No. of Visits</h2>
            <div class="percentage-circle visits" data-percentage="0"></div>
        </div>
    
        <!-- Customers Circle -->
        <div class="percentage-card">
            <h2>Customers</h2>
            <div class="percentage-circle customers" data-percentage="0"></div>
        </div>
    
        <!-- Sales Circle -->
        <div class="percentage-card">
            <h2>Sales</h2>
            <div class="percentage-circle sales" data-percentage="0"></div>
        </div>
    </div>
    

    <div class="sales-chart">
        <h2>Total Sales</h2>
        <canvas id="salesChart"></canvas>
    </div>

    <div class="top-products">
        <h2>Top Selling Products</h2>
        <ul>
            <li>Omega Speedmaster - In stock - ₹6,799</li>
            <li>Fossil Diamonds - In stock - ₹1,999</li>
            <li>Armani Exchange - In stock - ₹10,999</li>
            <li>Fossil Dark - In stock - ₹1,999</li>
        </ul>
    </div>

    <div class="download-options">
        <button class="download-button" onclick="downloadPDF()">Download PDF</button>
        <button class="download-button" onclick="downloadExcel()">Download Excel</button>
    </div>
</main>

<footer>
    <p>Tick-Tock</p>
    <p>About Us | Category | Blog</p>
    <div>
        <p>Information | Help Center | My Orders</p>
    </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    const ctx = document.getElementById('salesChart').getContext('2d');
    let salesChart; // Declare salesChart variable globally

    // Function to generate report and fetch data from the backend
    function generateReport() {
        const reportType = document.getElementById('reportType').value;
        let startDate = null;
        let endDate = null;

        if (reportType === 'custom') {
            startDate = document.getElementById('startDate').value;
            endDate = document.getElementById('endDate').value;
        }

        // Fetch dashboard data from backend
        fetch('/dashboard-data', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ reportType, startDate, endDate }),
        })
        .then(response => response.json())
        .then(data => {
            // Update the dashboard metrics
            updateDashboardData(
                `₹${data.totalGrandTotal.toLocaleString()}`, 
                data.totalOrders.toString(), 
                `₹${data.totalDiscount.toLocaleString()}`, 
                data.activeUsers.toString()
            );

            // Prepare the data for the chart
            const labels = data.salesData.map(item => item.label); // Labels (e.g., dates)
            const chartData = data.salesData.map(item => item.totalSales); // Sales totals

            // Update chart with the new data
            updateChart(labels, chartData);
        })
        .catch(error => console.error('Error fetching dashboard data:', error));
    }

    // Function to update dashboard totals
    function updateDashboardData(totalSales, totalOrders, totalDiscount, activeUsers) {
        document.getElementById('totalSales').innerText = totalSales;
        document.getElementById('totalOrders').innerText = totalOrders;
        document.getElementById('totalDiscount').innerText = totalDiscount;
        document.getElementById('newUsers').innerText = activeUsers;
    }

    // Function to update or create the sales chart
    function updateChart(labels, data) {
        if (salesChart) {
            // If the chart already exists, just update it
            salesChart.data.labels = labels;
            salesChart.data.datasets[0].data = data;
            salesChart.update();
        } else {
            // Create a new chart if one doesn't exist
            salesChart = new Chart(ctx, {
                type: 'line', // You can also use 'bar', 'pie', etc.
                data: {
                    labels: labels, // X-axis labels
                    datasets: [{
                        label: 'Total Sales',
                        data: data, // Y-axis data
                        borderColor: 'rgba(75, 192, 192, 1)',
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: {
                            beginAtZero: true
                        },
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }
    }
    document.getElementById('reportType').addEventListener('change', function() {
        const customRangeDiv = document.getElementById('customRange');
        customRangeDiv.style.display = this.value === 'custom' ? 'block' : 'none';
    });

  // Function to generate report and fetch data from the backend
function generateReport() {
    const reportType = document.getElementById('reportType').value;
    let startDate = null;
    let endDate = null;

    if (reportType === 'custom') {
        startDate = document.getElementById('startDate').value;
        endDate = document.getElementById('endDate').value;
    }

    // Fetch dashboard data from backend
    fetch('/dashboard-data', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ reportType, startDate, endDate }),
    })
    .then(response => response.json())
    .then(data => {
        // Update the dashboard metrics
        updateDashboardData(
            `₹${data.totalGrandTotal.toLocaleString()}`, 
            data.totalOrders.toString(), 
            `₹${data.totalDiscount.toLocaleString()}`, 
            data.activeUsers.toString()
        );

        // Prepare the data for the chart
        const labels = data.salesData.map(item => item.label); // Labels (e.g., dates)
        const chartData = data.salesData.map(item => item.totalSales); // Sales totals

        // Update chart with the new data
        updateChart(labels, chartData);

        // Update percentage data for circles
        updatePercentageCircles({
            profit: data.profitPercentage,
            visits: data.visitsPercentage,
            customers: data.customersPercentage,
            sales: data.salesPercentage
        });
    })
    .catch(error => console.error('Error fetching dashboard data:', error));
}

// Function to update percentage circles dynamically
function updatePercentageCircles(percentageData) {
    Object.keys(percentageData).forEach(circleClass => {
        const circleElement = document.querySelector(`.percentage-circle.${circleClass}`);
        const percentage = percentageData[circleClass];
        
        // Update the circle's percentage and background dynamically
        circleElement.style.background = `conic-gradient(${getCircleColor(circleClass)} 0% ${percentage}%, #f4f4f4 ${percentage}% 100%)`;
        circleElement.setAttribute('data-percentage', percentage);
    });
}

// Function to get the color for each circle
function getCircleColor(circleClass) {
    const circleColors = {
        profit: '#3498db',
        visits: '#e74c3c',
        customers: '#2ecc71',
        sales: '#f39c12'
    };
    return circleColors[circleClass] || '#000'; // Default to black if no match
}

    function downloadPDF() {
        const reportType = document.getElementById('reportType').value;
        let startDate = null;
        let endDate = null;

        if (reportType === 'custom') {
            startDate = document.getElementById('startDate').value;
            endDate = document.getElementById('endDate').value;
        }

        // Redirect to the backend route for PDF generation
        window.location.href = `/download/pdf?reportType=${reportType}&startDate=${startDate}&endDate=${endDate}`;
    }

    function downloadExcel() {
        const reportType = document.getElementById('reportType').value;
        let startDate = null;
        let endDate = null;

        if (reportType === 'custom') {
            startDate = document.getElementById('startDate').value;
            endDate = document.getElementById('endDate').value;
        }

        // Redirect to the backend route for Excel generation
        window.location.href = `/download/excel?reportType=${reportType}&startDate=${startDate}&endDate=${endDate}`;
    }


    document.addEventListener('DOMContentLoaded', function () {
    // Define the data you want to apply to each circle dynamically (from backend or static)
    const circleData = {
        profit: { percentage: 22, color: '#3498db' },
        visits: { percentage: 46, color: '#e74c3c' },
        customers: { percentage: 84, color: '#2ecc71' },
        sales: { percentage: 55, color: '#f39c12' }
    };

    // Loop through each circle and dynamically set the percentage and color
    Object.keys(circleData).forEach(circleClass => {
        const circleElement = document.querySelector(`.percentage-circle.${circleClass}`);
        const { percentage, color } = circleData[circleClass];
        
        // Set the percentage and color dynamically
        circleElement.style.setProperty('--percentage', `${percentage}%`);
        circleElement.style.setProperty('--color', color);
        circleElement.setAttribute('data-percentage', percentage);
    });
});
async function fetchDashboardData() {
            try {
                // Fetch data from your backend API
                const response = await fetch('/dashboard-data', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ reportType: 'monthly' }) // Example reportType
                });
                const data = await response.json();

                // Destructure required fields from response
                const { totalGrandTotal, totalOrders, totalDiscount, totalOfferAmount, salesData } = data;

                // Prepare the data for the percentage chart
                const totalSales = totalGrandTotal;
                const discountPercentage = (totalDiscount / 60) * 100;
                const offerPercentage = (totalOfferAmount / totalSales) * 100;
                const salesPercentage = 100 - (discountPercentage + offerPercentage);

                // Define labels and data for the chart
                const labels = ['Sales', 'Discounts', 'Offers'];
                const chartData = [salesPercentage, discountPercentage, offerPercentage];

                // Create the percentage chart using Chart.js
                const ctx = document.getElementById('salesPercentageChart').getContext('2d');
                const myChart = new Chart(ctx, {
                    type: 'pie', // Use pie chart to display percentages
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Sales Distribution',
                            data: chartData,
                            backgroundColor: [
                                'rgba(75, 192, 192, 0.2)',  // Sales color
                                'rgba(255, 99, 132, 0.2)',  // Discount color
                                'rgba(255, 206, 86, 0.2)',  // Offer color
                            ],
                            borderColor: [
                                'rgba(75, 192, 192, 1)',
                                'rgba(255, 99, 132, 1)',
                                'rgba(255, 206, 86, 1)',
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            tooltip: {
                                callbacks: {
                                    label: function (context) {
                                        const label = context.label || '';
                                        const value = context.raw.toFixed(2);
                                        return `${label}: ${value}%`;
                                    }
                                }
                            }
                        }
                    }
                });

            } catch (error) {
                console.error('Error fetching dashboard data:', error);
            }
        }

        // Call the function to fetch data and render the chart
        fetchDashboardData();
</script>

</body>
</html>














<%- include('../include/adminHeader.ejs') %>

<% 
if (typeof message !== 'undefined') {
    %>
    <p style="color: green; text-align: center;"><%= message %></p>
<%
}
%>

<section>
    <div class="container">
        <div class="row mt-4">
            <form class="d-flex" action="/search" method="post">
                <input class="form-control me-2" type="search" name="String" placeholder="Search" aria-label="Search">
                <button class="btn btn-outline-dark searchButton" type="submit">Search</button>
            </form>
            <a href="add-category" class="btn btn-dark ml-auto mb-5">Add Category</a>
        </div>

        <table class="table table-striped table-bordered mt-5" id="peopleTable">
            <thead>
                <tr>
                    <th scope="col">Image</th>
                    <th scope="col">Category Name</th>
                    <th scope="col">Offer</th>
                    <th scope="col">Actions</th>
                </tr>
            </thead>
            <tbody>
                <% 
                if (data.length > 0) {
                    for (let i = 0; i < data.length; i++) {
                        const offerValue = data[i].categoryOffer ? data[i].categoryOffer : 0;
                        const offerButtonLabel = offerValue > 0 ? 'Remove Offer' : 'Add Offer';
                %>
                <tr>
                    <td><img src="/<%= data[i].cimage %>" width="60px" height="60px" alt="<%= data[i].cname %>"></td>
                    <td><%= data[i].cname %></td>
                    <td><%= offerValue %></td>
                    <td>
                        <a href="/edit-category/<%= data[i]._id %>" class="btn btn-primary">Edit</a>
                        <% if (offerValue > 0) { %>
                            <button class="btn btn-danger" onclick="removeOffer('<%= data[i]._id %>')">Remove Offer</button>
                        <% } else { %>
                            <button class="btn btn-success" onclick="showOfferPopup('<%= data[i]._id %>')">Add Offer</button>
                        <% } %>
                        <form class="d-inline" id="deleteButton<%= data[i]._id %>" action="/delete-category/<%= data[i]._id %>" method="POST">
                            <button class="btn btn-danger deleteCategory" type="submit">Delete</button>      
                        </form>
                    </td>
                </tr>
                <% 
                    }
                } else { 
                %>
                <tr>
                    <td colspan="4">No categories found.</td>
                </tr>
                <% 
                } 
                %>
            </tbody>
        </table>
    </div>
</section>

<script>
    function showOfferPopup(categoryId) {
        Swal.fire({
            title: 'Add Offer',
            html: `
                <input type="number" id="offerValue" class="swal2-input" placeholder="Enter Offer Value (%)" required>
            `,
            confirmButtonText: 'Submit',
            showCancelButton: true,
            preConfirm: () => {
                const offerValue = Swal.getInput().value;
                if (!offerValue) {
                    Swal.showValidationMessage(`Please enter an offer value.`);
                }
                return { offerValue: offerValue };
            }
        }).then((result) => {
            if (result.isConfirmed) {
                const { offerValue } = result.value;
                fetch('/add-offer/' + categoryId, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ offerValue }) // Send the offer value
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        Swal.fire('Success!', 'The offer has been added.', 'success').then(() => {
                            location.reload(); // Reload to reflect changes
                        });
                    } else {
                        Swal.fire('Error!', 'There was an error adding the offer.', 'error');
                    }
                });
            }
        });
    }

    function removeOffer(categoryId) {
        Swal.fire({
            title: 'Are you sure?',
            text: "Do you really want to remove this offer?",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonText: 'Yes, remove it!',
            cancelButtonText: 'No, keep it'
        }).then((result) => {
            if (result.isConfirmed) {
                fetch('/remove-offer/' + categoryId, {
                    method: 'POST'
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        Swal.fire('Removed!', 'The offer has been removed.', 'success').then(() => {
                            location.reload(); // Reload to reflect changes
                        });
                    } else {
                        Swal.fire('Error!', 'There was an error removing the offer.', 'error');
                    }
                });
            }
        });
    }

    const deleteButtons = document.querySelectorAll('.deleteCategory');
    deleteButtons.forEach((button) => {
        button.addEventListener('click', (e) => {
            const categoryId = e.target.closest('form').id.replace('deleteButton', '');
            if (!confirm("Do you really want to delete this category?")) {
                e.preventDefault();
            } else {
                Swal.fire({
                    title: 'Deleting...',
                    text: 'Your category is being deleted.',
                    icon: 'info',
                    timer: 2000,
                    showConfirmButton: false
                });
                const form = document.getElementById('deleteButton' + categoryId);
                form.submit();
            }
        });
    });
</script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<%- include('../include/adminFooter.ejs') %>



my profile


<%- include('../include/userHeader.ejs') %>

<link rel="stylesheet" href="/css/userProfile.css">
<div class="container">
    <header>
        <h1>My Account</h1>
        <% if(typeof message !== 'undefined'){ %>
            <script>
                Swal.fire({
                    icon: 'error',
                    title: 'Oops...',
                    text: '<%= message %>',
                });
            </script>
        <% } %>
    </header>

    <section class="profile">
        <div class="profile-icon">
            <img src="" alt="User Icon">
            <p class="email"></p>
        </div>
        <div class="user-details">
            <h2>Name: <%= data.name %></h2>
            <h4>Email: <%= data.email %></h3>
            <h4>Contact No: <%= data.phone %></h3>
            <p><%= address.house_no %>, <%= address.street %> <%= address.locality %>, <%= address.city %>, <%= address.district %></p>
            <p><%= address.pincode %>, <%= address.state %></p>
            <button id="edit-profile-btn">Edit Profile</button>
            <button id="add-address-btn">Add New Address</button>
        </div>
    </section>

    <section class="address-form" id="address-form" style="display: none;">
        <h3>Add New Address</h3>
        <form action="/add-address" method="POST" id="new-address-form">
            <input type="text" id="name" name="name" placeholder="Full Name" required>
            <input type="number" id="phone" name="phone" placeholder="Phone Number" required>
            <small id="phoneError" class="error-message" style="display: none; color: red;">Invalid phone number</small>
    
            <input type="text" id="house_no" name="house_no" placeholder="House No" required>
            <input type="text" id="street" name="street" placeholder="Street" required>
            <input type="text" id="locality" name="locality" placeholder="Locality" required>
            <input type="text" id="city" name="city" placeholder="City" required>
            <input type="number" id="pincode" name="pincode" placeholder="Pincode" required>
            <small id="pincodeError" class="error-message" style="display: none; color: red;">Invalid pincode</small>
    
            <input type="text" id="district" name="district" placeholder="District" required>
            <input type="text" id="state" name="state" placeholder="State" required>
            <input type="submit" value="Save address">
        </form>
    </section>

    <section class="edit-profile-form" id="edit-profile-form" style="display: none;">
        <h3>Edit Profile</h3>
        <form action="/edit-profile/<%= data._id %>" method="POST" id="profile-form">
            <input type="text" id="edit-name" name="name" placeholder="Full Name" value="<%= data.name %>" required>
            <input type="number" id="edit-phone" name="phone" placeholder="Phone Number" value="<%= data.phone %>" required>
            <input type="email" id="edit-email" name="email" placeholder="Email" value="<%= data.email %>" required>
            <div class="form-group">
                <input type="submit" value="Save Profile">
            </div>
        </form>
    </section>

    <section class="orders">
        <h3>Your Orders</h3>
        <div class="order">
            <p>Order #12345 - <span class="status">Shipped</span></p>
        </div>
        <div class="order">
            <p>Order #12346 - <span class="status">Delivered</span></p>
        </div>
        <div class="order">
            <p>Order #12347 - <span class="status">Processing</span></p>
        </div>
    </section>
</div>

<script>
    document.getElementById('add-address-btn').addEventListener('click', function() {
        const addressForm = document.getElementById('address-form');
        addressForm.style.display = addressForm.style.display === 'none' || addressForm.style.display === '' ? 'block' : 'none';
    });

    document.getElementById('edit-profile-btn').addEventListener('click', function() {
        const profileForm = document.getElementById('edit-profile-form');
        profileForm.style.display = profileForm.style.display === 'none' || profileForm.style.display === '' ? 'block' : 'none';
    });

    // Form validation for name and phone number
    document.getElementById('new-address-form').addEventListener('submit', function(event) {
        let isValid = true;
        const phoneInput = document.getElementById('phone');
        const phoneError = document.getElementById('phoneError');
        const nameInput = document.getElementById('name');
        
        // Phone number validation (10 digits)
        if (!/^\d{10}$/.test(phoneInput.value)) {
            phoneError.style.display = 'block';
            isValid = false;
        } else {
            phoneError.style.display = 'none';
        }

        // Name validation (no numbers)
        if (/\d/.test(nameInput.value)) {
            Swal.fire({
                icon: 'error',
                title: 'Invalid Name',
                text: 'Name should not contain numbers.',
            });
            isValid = false;
        }

        if (!isValid) {
            event.preventDefault(); // Prevent form submission if validation fails
        }
    });

    document.getElementById('profile-form').addEventListener('submit', function(event) {
        let isValid = true;
        const phoneInput = document.getElementById('edit-phone');
        
        // Phone number validation (10 digits)
        if (!/^\d{10}$/.test(phoneInput.value)) {
            Swal.fire({
                icon: 'error',
                title: 'Invalid Phone Number',
                text: 'Phone number must be exactly 10 digits.',
            });
            isValid = false;
        }

        const nameInput = document.getElementById('edit-name');
        if (/\d/.test(nameInput.value)) {
            Swal.fire({
                icon: 'error',
                title: 'Invalid Name',
                text: 'Name should not contain numbers.',
            });
            isValid = false;
        }

        if (!isValid) {
            event.preventDefault(); // Prevent form submission if validation fails
        }
    });
</script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<%- include('../include/userFooter') %>
